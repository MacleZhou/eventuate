

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example application &mdash; Eventuate</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/tabbedcode.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Eventuate" href="index.html"/>
        <link rel="prev" title="FAQ" href="faq.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  
	<script src="//fonts.redbullmediahouse.com/snv5vzo.js"></script>
	<script>try{Typekit.load();}catch(e){}</script>
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          
          <a href="index.html"><img src="_static/RedBullMediaHouse-dark.png" class="logo" /></a>
        

		
<div role="search" class="searchbox">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search Eventuate" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview.html#event-sourcing">Event sourcing</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#event-collaboration">Event collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#event-log">Event log</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#event-bus">Event bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#event-ordering-and-consistency">Event ordering and consistency</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#stream-processing-adapters">Stream processing adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html#related-projects">Related projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#event-logs">Event logs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#replication-networks">Replication networks</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#replication-filters">Replication filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#storage-backends">Storage backends</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#event-sourcing">Event sourcing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-sourced-actors">Event-sourced actors</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-sourced-writers">Event-sourced writers</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-sourced-processors">Event-sourced processors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#event-collaboration">Event collaboration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-driven-communication">Event-driven communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#actor-state-replication">Actor state replication</a></li>
<li class="toctree-l3"><a class="reference internal" href="architecture.html#event-aggregation">Event aggregation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#vector-clocks">Vector clocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html#batching">Batching</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#event-sourced-actors">Event-sourced actors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user-guide.html#creating-a-single-instance">Creating a single instance</a></li>
<li class="toctree-l3"><a class="reference internal" href="user-guide.html#creating-two-isolated-instances">Creating two isolated instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="user-guide.html#creating-two-replica-instances">Creating two replica instances</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#detecting-concurrent-updates">Detecting concurrent updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#tracking-conflicting-versions">Tracking conflicting versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#resolving-conflicting-versions">Resolving conflicting versions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user-guide.html#automated-conflict-resolution">Automated conflict resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="user-guide.html#interactive-conflict-resolution">Interactive conflict resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#operation-based-crdts">Operation-based CRDTs</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#conditional-requests">Conditional requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="user-guide.html#event-driven-communication">Event-driven communication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reference/event-log.html">Event log</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-log.html#local-event-log">Local event log</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#leveldb-storage-backend">LevelDB storage backend</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#cassandra-storage-backend">Cassandra storage backend</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#custom-storage-backends">Custom storage backends</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-log.html#replicated-event-log">Replicated event log</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#replication-endpoints">Replication endpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#replication-filters">Replication filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#update-notifications">Update notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#failure-detection">Failure detection</a></li>
<li class="toctree-l4"><a class="reference internal" href="reference/event-log.html#disaster-recovery">Disaster recovery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-log.html#deleting-events">Deleting events</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html">Event-sourced actors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#command-handler">Command handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#state-synchronization">State synchronization</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#event-handler">Event handler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-sourced-views">Event-sourced views</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-sourced-writers">Event-sourced writers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#stateful-writers">Stateful writers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-sourced-processors">Event-sourced processors</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#state-recovery">State recovery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#backpressure">Backpressure</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#recovery-using-an-application-defined-log-sequence-number">Recovery using an application-defined log sequence number</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#snapshots">Snapshots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#storage-locations">Storage locations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-routing">Event routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#event-driven-communication">Event-driven communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#reliable-delivery">Reliable delivery</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#conditional-requests">Conditional requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#command-stashing">Command stashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#behavior-changes">Behavior changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#failure-handling">Failure handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#circuit-breaker">Circuit breaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#persist-failure-handling"><code class="docutils literal notranslate"><span class="pre">persist</span></code> failure handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#persistonevent-failure-handling"><code class="docutils literal notranslate"><span class="pre">persistOnEvent</span></code> failure handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#recovery-failure-handling">Recovery failure handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#batch-write-failure-handling">Batch write failure handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#batch-replication-failure-handling">Batch replication failure handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/event-sourcing.html#custom-serialization">Custom serialization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#custom-event-serialization">Custom event serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#custom-snapshot-serialization">Custom snapshot serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#custom-crdt-serialization">Custom CRDT serialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/event-sourcing.html#resolution-of-serializers-when-deserializing">Resolution of serializers when deserializing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference/configuration.html">Transport Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference/configuration.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reference/configuration.html#eventuate-core">eventuate-core</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/configuration.html#eventuate-crdt">eventuate-crdt</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/configuration.html#eventuate-log-cassandra">eventuate-log-cassandra</a></li>
<li class="toctree-l3"><a class="reference internal" href="reference/configuration.html#eventuate-log-leveldb">eventuate-log-leveldb</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="adapters.html">Adapters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="adapters/stream.html">Akka Streams adapter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adapters/stream.html#event-source">Event source</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/stream.html#event-writer">Event writer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/stream.html#event-processor">Event processor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="adapters/stream.html#consuming-from-a-shared-source">Consuming from a shared source</a></li>
<li class="toctree-l4"><a class="reference internal" href="adapters/stream.html#consuming-from-multiple-sources">Consuming from multiple sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="adapters/stream.html#event-processing-progress-tracking">Event processing progress tracking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adapters/spark.html">Spark adapter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adapters/spark.html#batch-processing">Batch processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/spark.html#stream-processing">Stream processing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="adapters/vertx.html">Vert.x adapter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#event-producers">Event producers</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#event-processing">Event processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#adapter-usage">Adapter usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#vert-x-publish-event-producer">Vert.x publish event producer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#vert-x-point-to-point-event-producer">Vert.x point-to-point event producer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#log-event-producer">Log event producer</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#message-codecs">Message codecs</a></li>
<li class="toctree-l3"><a class="reference internal" href="adapters/vertx.html#event-metadata">Event metadata</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-docs.html">API docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="resources.html#articles">Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html#presentations">Presentations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download</a><ul>
<li class="toctree-l2"><a class="reference internal" href="download.html#binaries">Binaries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="download.html#maven">Maven</a></li>
<li class="toctree-l3"><a class="reference internal" href="download.html#sbt">SBT</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="download.html#sources">Sources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developers.html#contributing-to-eventuate">Contributing to Eventuate</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#building-eventuate">Building Eventuate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developers.html#binaries">Binaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="developers.html#documentation">Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project.html">Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="project.html#community">Community</a></li>
<li class="toctree-l2"><a class="reference internal" href="project.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-does-akka-persistence-compare-to-eventuate">How does Akka Persistence compare to Eventuate?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-apache-kafka-be-integrated-with-eventuate">How can Apache Kafka be integrated with Eventuate?</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#domain">Domain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replication">Replication</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interface">Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running">Running</a></li>
<li class="toctree-l2"><a class="reference internal" href="#disaster-recovery">Disaster recovery</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html"><img src="_static/RedBullMediaHouse-light.png" class="logo" /></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li>
		<a href="index.html"><h2><span class="breadcrumbicon rbicons topfront"><i class="fa fa-calendar"></i></span>Eventuate</h2></a> &raquo;
	</li>
    
    <li>Example application</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="example-application">
<span id="id1"></span><h1>Example application<a class="headerlink" href="#example-application" title="Permalink to this headline">¶</a></h1>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The example application is rather outdated and we plan to design and implement a better one to demonstrate the latest Eventuate features and best practices. If you have any preferences what you’d like to see in a new example application, please add a comment to ticket <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/issues/337">#337</a> or contact us in the <a class="reference external" href="https://gitter.im/RBMHTechnology/eventuate">forum</a>.</p>
</div>
<p>The example application is an over-simplified order management application that allows users to add and remove items from orders via a command-line interface. Order instances are replicated across locations and can be updated at any location. Orders remain writeable during partitions and conflicting updates can be resolved interactively when the partition heals. The example application source code is available as <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/tree/master/src/test/scala/com/rbmhtechnology/example/ordermgnt">Scala version</a> and as <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/tree/master/src/test/java/com/rbmhtechnology/example/japi/ordermgnt">Java 8 version</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This example application was created to demonstrate <em>interactive conflict resolution</em>. A more realistic order management application would probably use automated conflict resolution using a <a class="reference external" href="latest/api/index.html#com.rbmhtechnology.eventuate.crdt.ORCartService">shopping cart CRDT</a>, for example.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">There is a tutorial-style <a class="reference external" href="https://www.typesafe.com/community/core-tools/activator-and-sbt">activator</a> template for the scala-version that guides you through the code: <a class="reference external" href="https://www.typesafe.com/activator/template/akka-eventuate-scala">akka-eventuate-scala</a>.</p>
</div>
<div class="section" id="domain">
<h2>Domain<a class="headerlink" href="#domain" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Order</span></code> domain object is defined as follows:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">Order</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Nil</span><span class="o">,</span> <span class="n">cancelled</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">addItem</span><span class="o">(</span><span class="n">item</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Order</span> <span class="o">=</span>
    <span class="n">copy</span><span class="o">(</span><span class="n">items</span> <span class="k">=</span> <span class="n">item</span> <span class="o">::</span> <span class="n">items</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">removeItem</span><span class="o">(</span><span class="n">item</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Order</span> <span class="o">=</span>
    <span class="n">copy</span><span class="o">(</span><span class="n">items</span> <span class="k">=</span> <span class="n">items</span><span class="o">.</span><span class="n">filterNot</span><span class="o">(</span><span class="k">_</span> <span class="o">==</span> <span class="n">item</span><span class="o">))</span>

  <span class="k">def</span> <span class="n">cancel</span><span class="k">:</span> <span class="kt">Order</span> <span class="o">=</span>
    <span class="n">copy</span><span class="o">(</span><span class="n">cancelled</span> <span class="k">=</span> <span class="kc">true</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span><span class="o">()</span> <span class="k">=</span>
    <span class="s">s&quot;[</span><span class="si">${</span><span class="n">id</span><span class="si">}</span><span class="s">] items=</span><span class="si">${</span><span class="n">items</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)</span><span class="si">}</span><span class="s"> cancelled=</span><span class="si">${</span><span class="n">cancelled</span><span class="si">}</span><span class="s">&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Order creation and updates are tracked as events in a replicated event log. At each location, there is one event-sourced <code class="docutils literal notranslate"><span class="pre">OrderActor</span></code> instance per created <code class="docutils literal notranslate"><span class="pre">Order</span></code> instance and one event-sourced <code class="docutils literal notranslate"><span class="pre">OrderView</span></code> instance that counts the updates made to all orders.</p>
</div>
<div class="section" id="replication">
<h2>Replication<a class="headerlink" href="#replication" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">OrderActor</span></code>s are replicated across locations A - F, each running as separate process on <code class="docutils literal notranslate"><span class="pre">localhost</span></code> (see section <a class="reference internal" href="#running"><span class="std std-ref">Running</span></a>):</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">------</span> <span class="n">E</span>
 <span class="o">\</span>      <span class="o">/</span>
  <span class="n">C</span> <span class="o">--</span> <span class="n">D</span>
 <span class="o">/</span>      <span class="o">\</span>
<span class="n">B</span>        <span class="n">F</span>
</pre></div>
</div>
<p>Each location can create and update orders, even under presence of partitions. In the example application, partitions can be created by shutting down locations. For example, when shutting down location <code class="docutils literal notranslate"><span class="pre">C</span></code>, partitions <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">A-E-D-F</span></code> are created.</p>
<p>Concurrent updates to orders with different order id do not conflict. Concurrent updates to replicas of the same order are considered as conflict and must be resolved by the user, otherwise, further updates to that order are rejected. Updates are only rejected if a conflict is already <em>visible</em> to a location.</p>
</div>
<div class="section" id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<p>Each location of the example application has a simple command-line interface to create and update orders:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">&lt;order-id&gt;</span></code> creates an order with given <code class="docutils literal notranslate"><span class="pre">order-id</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">add</span> <span class="pre">&lt;order-id&gt;</span> <span class="pre">&lt;item&gt;</span></code> adds <code class="docutils literal notranslate"><span class="pre">item</span></code> to an order’s items list.</li>
<li><code class="docutils literal notranslate"><span class="pre">remove</span> <span class="pre">&lt;order-id&gt;</span> <span class="pre">&lt;item&gt;</span></code> removes <code class="docutils literal notranslate"><span class="pre">item</span></code> from an order’s items list.</li>
<li><code class="docutils literal notranslate"><span class="pre">cancel</span> <span class="pre">&lt;order-id&gt;</span></code> cancels an order.</li>
<li><code class="docutils literal notranslate"><span class="pre">save</span> <span class="pre">&lt;order-id&gt;</span></code> saves a snapshot of an order.</li>
</ul>
<p>If there’s a conflict from a concurrent update, the conflict must be resolved by selecting one of the conflicting versions<a class="footnote-reference" href="#id5" id="id2">[1]</a>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">resolve</span> <span class="pre">&lt;order-id&gt;</span> <span class="pre">&lt;index&gt;</span></code> resolves a conflict by selecting a version <code class="docutils literal notranslate"><span class="pre">index</span></code>. Only the location that initially created the order can resolve the conflict<a class="footnote-reference" href="#id6" id="id3">[2]</a>.</li>
</ul>
<p>Other commands are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">count</span> <span class="pre">&lt;order-id&gt;</span></code> prints the number of updates to an order, including creation. Update counts are maintained by a separate view that consumes order events from all <code class="docutils literal notranslate"><span class="pre">OrderActor</span></code>s on the replicated event log.</li>
<li><code class="docutils literal notranslate"><span class="pre">state</span></code> prints the current state i.e. all orders at a location. Location state may differ during partitions.</li>
<li><code class="docutils literal notranslate"><span class="pre">exit</span></code> stops a location and the replication connections to and from that location.</li>
</ul>
<p>Update results from user commands and replicated events are written to <cite>stdout</cite>. A location’s current state is also printed after successful recovery.</p>
</div>
<div class="section" id="running">
<span id="id4"></span><h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>Before you can run the example application, install <a class="reference external" href="http://www.scala-sbt.org/">sbt</a> and run:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">sbt</span> <span class="n">compile</span>
</pre></div>
</div>
<p>from the project’s root directory (needs to be done only once). Then, run:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ordermgnt</span>
</pre></div>
</div>
<p>This should open six terminal windows, representing locations A - F. For running the Java version of the example application use the <code class="docutils literal notranslate"><span class="pre">-j</span></code> or <code class="docutils literal notranslate"><span class="pre">--java</span></code> option:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ordermgnt</span> <span class="o">--</span><span class="n">java</span>
</pre></div>
</div>
<p>Create and update some orders and see how changes are propagated to other locations. To make concurrent updates to an order, for example, enter <code class="docutils literal notranslate"><span class="pre">exit</span></code> at location <code class="docutils literal notranslate"><span class="pre">C</span></code>, and add different items to that order at locations <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">F</span></code>. When starting location <code class="docutils literal notranslate"><span class="pre">C</span></code> again with:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ordermgnt</span><span class="o">-</span><span class="n">location</span> <span class="n">A</span>
</pre></div>
</div>
<p>or the Java version with:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ordermgnt</span><span class="o">-</span><span class="n">location</span> <span class="o">--</span><span class="n">java</span> <span class="n">A</span>
</pre></div>
</div>
<p>both updates propagate to all other locations which are then displayed as conflict. Resolve the conflict with the <code class="docutils literal notranslate"><span class="pre">resolve</span></code> command. Conflict resolution writes a conflict resolution event to the replicated event log so that the conflict is automatically resolved at all locations.</p>
</div>
<div class="section" id="disaster-recovery">
<span id="example-disaster-recovery"></span><h2>Disaster recovery<a class="headerlink" href="#disaster-recovery" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="reference/event-log.html#disaster-recovery"><span class="std std-ref">Disaster recovery</span></a> in the example application can be tested by removing the event log of a location and starting the location again with disaster recovery enabled. For example, to remove the event log at location <code class="docutils literal notranslate"><span class="pre">C</span></code>, stop the location with <code class="docutils literal notranslate"><span class="pre">exit</span></code> and delete its LevelDB directory:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">example</span><span class="o">-</span><span class="n">logs</span><span class="o">/</span><span class="n">s</span><span class="o">-</span><span class="nc">C_default</span><span class="o">/</span>
</pre></div>
</div>
<p>To delete the event log written by the Java version of the example application run:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">example</span><span class="o">-</span><span class="n">logs</span><span class="o">/</span><span class="n">j</span><span class="o">-</span><span class="nc">C_default</span><span class="o">/</span>
</pre></div>
</div>
<p>To start location <code class="docutils literal notranslate"><span class="pre">C</span></code> again with disaster recovery enabled, use the <code class="docutils literal notranslate"><span class="pre">-r</span></code> or <code class="docutils literal notranslate"><span class="pre">--recover</span></code> option:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">example</span><span class="o">/</span><span class="n">ordermgnt</span><span class="o">-</span><span class="n">location</span> <span class="o">--</span><span class="n">recover</span> <span class="n">C</span>
</pre></div>
</div>
<p>or the Java version with:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">eventuate</span><span class="o">-</span><span class="n">example</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">ordermgnt</span><span class="o">-</span><span class="n">location</span> <span class="o">--</span><span class="n">recover</span> <span class="o">--</span><span class="n">java</span> <span class="n">C</span>
</pre></div>
</div>
<p>Recovery may take up to 20 seconds when using the default <a class="reference internal" href="reference/configuration.html#configuration"><span class="std std-ref">Configuration</span></a> settings for event replication and disaster recovery. To speed up the process you may want to the use following configuration settings:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">replication</span><span class="o">.</span><span class="n">retry</span><span class="o">-</span><span class="n">delay</span> <span class="k">=</span> <span class="mi">1</span><span class="n">s</span>
<span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">replication</span><span class="o">.</span><span class="n">remote</span><span class="o">-</span><span class="n">read</span><span class="o">-</span><span class="n">timeout</span> <span class="k">=</span> <span class="mi">2</span><span class="n">s</span>
<span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">recovery</span><span class="o">.</span><span class="n">remote</span><span class="o">-</span><span class="n">operation</span><span class="o">-</span><span class="n">retry</span><span class="o">-</span><span class="n">max</span> <span class="k">=</span> <span class="mi">10</span>
<span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">recovery</span><span class="o">.</span><span class="n">remote</span><span class="o">-</span><span class="n">operation</span><span class="o">-</span><span class="n">retry</span><span class="o">-</span><span class="n">delay</span> <span class="k">=</span> <span class="mi">1</span><span class="n">s</span>
<span class="n">eventuate</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">recovery</span><span class="o">.</span><span class="n">remote</span><span class="o">-</span><span class="n">operation</span><span class="o">-</span><span class="n">timeout</span> <span class="k">=</span> <span class="mi">1</span><span class="n">s</span>
</pre></div>
</div>
<p>Disaster recovery can also start from a previous, older backup of the LevelDB directory. After having removed the current LevelDB directory, install the backup and try running disaster recovery again.</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>Merging the content of conflicting versions is another option which will be supported in a later release (see <a class="reference external" href="https://github.com/RBMHTechnology/eventuate/issues/101">#101</a>).</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>This is a static rule for distributed agreement which doesn’t require coordination among locations.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
		    
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="faq.html" title="FAQ">Previous</a>
      
    </div>
  
        </div>
	  </div>
    <div class="wrapper-footer">
<footer>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 - 2016 Red Bull Media House.  | <a href="http://rbmhtechnology.github.io/imprint" target="_blank">Imprint</a> | <a href="http://rbmhtechnology.github.io/termsconditions" target="_blank">Terms &amp; Conditions</a> | <a href="http://rbmhtechnology.github.io/dataprivacypolicy" target="_blank">Data Privacy Policy</a> 
    </p>
  </div>

</footer>
</div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.10-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/tabbedcode.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>